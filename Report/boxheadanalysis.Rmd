---
title: "Boxhead Analysis"
author: "Ling L.D."
date: "November 13, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Helper functions:
```{r}
isEven <- function(num){
  return (num %% 2 == 0)
}
```

Getting data files:
```{r}
filenames = list.files(path = ".", pattern = ".csv")
```


```{r}
responses <- read.csv("responses.csv", as.is = TRUE)
pids <- as.data.frame(matrix(nrow = nrow(responses), ncol = 22 + 6))
colnames(pids) <- c("exp", "PID", "age", "male", "Social.Jibo", "PA.easy", "PA.hard", "PA.etime", "PA.htime", "WA.easy", "WA.hard", "WA.htime", "WA.etime", "RC.easy", "RC.hard", "RC.etime", "RC.htime", "cs1", "cs2", "cs3", "cs4", "rExposure", "empathy", "self.efficacy", "BFI.extraversion", "BFI.neuroticism", "jpn", "invalid")
for (i in 1:nrow(responses)){
  pids[i, 1] <- isEven(responses[i, 2])
  pids[i, 2:3] <- responses[i, 2:3]
  pids[i, 4] <- responses[i, 4] == "Male"
  pids[i, 5] <- responses[i, 9]
  pids[i, "jpn"] <- responses[i, 2] %in% c(546, 57, 910, 696, 214)
  pids[i, "invalid"] <- responses[i, 2] %in% c(778, 957, 440, 963, 
                                             804, 381, 764, 97, 21, 228)
}
```

Questionnaire score calculation:
```{r}
csrScore <- function(i){
  cs.resp <- responses[i, 5]
  r.resp <- responses[i, 6]
  cs1 <- "never programmed before"
  cs2 <- "consider myself a novice"
  cs3 <- "intermediate programmer"
  cs4 <- "major component"
  r1 <- "movies"
  r2 <- "home or workplace"
  r3 <- "study"
  r4 <- "social interaction"
  r5 <- "programmed"
  return (c(length(grep(cs1, cs.resp)), length(grep(cs2, cs.resp)),
  length(grep(cs3, cs.resp)), length(grep(cs4, cs.resp)),
  length(c(grep(r1, r.resp), grep(r2, r.resp), grep(r3, r.resp),
  grep(r4, r.resp), grep(r5, r.resp)))))
}

getMeanScore <- function(i, inds, rev, maxsc){
  rscp <- responses
  for (r in rev){
    rscp[i, r] <- maxsc - responses[i, r] + 1
  }
  df <- rscp[i, inds]
  sum <- 0
  for (c in inds){
    sum = sum + rscp[i, c]
  }
  return (sum/length(inds))
}

for (i in 1:nrow(responses)){
  pids[i, 18:21] <- csrScore(i)[1:4]
  pids[i, "rExposure"] <- csrScore(i)[5]
  inds <- 21:34
  rev <- c(22, 25, 29, 32, 33) # Reverse scored!
  pids[i, "empathy"] <- getMeanScore(i, inds, rev, 7)
  inds <- 35:47
  rev <- c(37, 38, 39, 40, 43, 44, 46) # Reverse scored!
  pids[i, "self.efficacy"] <- getMeanScore(i, inds, rev, 7)
  inds <- c(48, 53, 58, 68, 73, 78, 83)
  rev <- c(53, 68, 78)
  pids[i, "BFI.extraversion"] <- getMeanScore(i, inds, rev, 7)
  inds <- c(51, 56, 61, 66, 71, 76, 81, 86)
  rev <- c(56, 71, 81)
  pids[i, "BFI.neuroticism"] <- getMeanScore(i, inds, rev, 7)
}

t.test(pids$cs1[pids$exp == 1], pids$cs1[pids$exp == 0])
t.test(pids$cs2[pids$exp == 1], pids$cs2[pids$exp == 0])
t.test(pids$cs3[pids$exp == 1], pids$cs3[pids$exp == 0])
t.test(pids$cs4[pids$exp == 1], pids$cs4[pids$exp == 0])

t.test(pids$rExposure[pids$exp == 1], pids$rExposure[pids$exp == 0])
t.test(pids$empathy[pids$exp == 1], pids$empathy[pids$exp == 0])
t.test(pids$self.efficacy[pids$exp == 1], pids$self.efficacy[pids$exp == 0])#**
t.test(pids$BFI.extraversion[pids$exp == 1], pids$BFI.extraversion[pids$exp == 0])
t.test(pids$BFI.neuroticism[pids$exp == 1], pids$BFI.neuroticism[pids$exp == 0])

t.test(pids$male[pids$exp == 1], pids$male[pids$exp == 0])
t.test(pids$age[pids$exp == 1], pids$age[pids$exp == 0])
```


Manipulation check:
```{r}
# Mean social scores for Jibo: exp vs. control
t.test(pids$Social.Jibo[pids$exp == 1], pids$Social.Jibo[pids$exp == 0])
socialsc <- aov(Social.Jibo ~ exp, data = pids)
summary(socialsc)
# p = .19, t = 1.34, means = 5.88, 4.7
getMeanSD <- function(var){
  print(mean(var[pids$exp == 1]))
  print(sd(var[pids$exp == 1]))
  print(mean(var[pids$exp == 0]))
  print(sd(var[pids$exp == 0]))
}

getMeanSD(pids$Social.Jibo)

summary(aov(Social.Jibo ~ exp + BFI.extraversion + BFI.neuroticism + empathy + age + male + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))
# Do social scores correlate with performance?
```

PA analysis:
```{r}
for (i in 1:nrow(pids)){
  pid <- pids$PID[i]
  pafile <- filenames[grep(paste0("^", pid, "_pa"), filenames)]
  pafile <- read.csv(pafile, as.is = TRUE)
  pafile$correctness <- as.logical(pafile$correctness)
  # for time, excuse cue 0 since some skipped instructions and took extra time
  pids$PA.hard[i] <- mean(pafile$correctness[1:24])
  pids$PA.htime[i] <- mean(pafile$time[1:24][(pafile$cue != 0)[1:24]])
  pids$PA.easy[i] <- mean(pafile$correctness[25:48])
  pids$PA.etime[i] <- mean(pafile$time[25:48][(pafile$cue != 0)[25:48]])
}

t.test(pids$PA.hard, pids$PA.easy, paired = TRUE) # .75 vs .80 p = .19

mean(pids$PA.hard)
sd(pids$PA.hard)
mean(pids$PA.easy)
sd(pids$PA.easy)

cor.test(pids$Social.Jibo, pids$PA.hard)
summary(lm(formula = PA.hard ~ Social.Jibo, data = pids))
# r = 0.29, B = 0.02, p = 0.10
cor.test(pids$Social.Jibo, pids$PA.easy)
summary(lm(formula = PA.easy ~ Social.Jibo, data = pids))
# r = 0.39, B = 0.02, p = 0.03 SIGNIFICANT!
plot(pids$Social.Jibo, pids$PA.easy, main = "easy PA score by Jibo Social rating", 
     xlab = "Jibo Social rating", ylab = "average easy PA score")
abline(a = 0.686, b = 0.021, col = "red")
text("y = 0.021 + 0.686x", x = 3.5, y = 0.7, col = "red")

summary(lm(formula = I((pids$PA.easy + pids$PA.hard)/2) ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, I((pids$PA.easy + pids$PA.hard)/2), main = "total PA score by Jibo Social rating", xlab = "Jibo Social rating", ylab = "total PA score")
abline(a = 0.668, b = 0.02, col = "red")
text("y = 0.668 + 0.002x", x = 3.5, y = .7, col = "red")
cor.test((pids$PA.easy + pids$PA.hard)/2, pids$Social.Jibo)

# time: nothing significant
t.test(pids$PA.htime[pids$exp == 1], pids$PA.htime[pids$exp == 0])
t.test(pids$PA.etime[pids$exp == 1], pids$PA.etime[pids$exp == 0])
t.test((pids$PA.etime[pids$exp == 1] + pids$PA.htime[pids$exp == 1])/2, 
       (pids$PA.etime[pids$exp == 0] + pids$PA.htime[pids$exp == 0])/2)

summary(lm(formula = PA.easy ~ Social.Jibo + jpn, data = pids))
summary(lm(formula = I((pids$PA.easy + pids$PA.hard)/2) ~ Social.Jibo + jpn, data = pids))

avgex = (pids$PA.hard[pids$exp == 1] + pids$PA.easy[pids$exp == 1])/2
avgctrl = (pids$PA.hard[pids$exp == 0] + pids$PA.easy[pids$exp == 0])/2
t.test(avgex, avgctrl)
scoredf <- as.data.frame(matrix(nrow = 2, ncol = 2))
colnames(scoredf) <- c("mean", "sd")
scoredf[1, ] <- c(mean(avgex), sd(avgex))
scoredf[2, ] <- c(mean(avgctrl), sd(avgctrl))
bp <- barplot(scoredf$mean, main = "Average PA score by condition", 
        names.arg = c("Experimental", "Control"), col = 4:2, ylim = c(0, 1))
arrows(x0 = bp , y0 = scoredf$mean + scoredf$sd, y1 = scoredf$mean - scoredf$sd, 
       angle = 90, code = 3)


t.test(pids$PA.hard[pids$exp == 1], pids$PA.hard[pids$exp == 0])
scoredf[1, ] <- c(mean(pids$PA.hard[pids$exp == 1]), sd(pids$PA.hard[pids$exp == 1]))
scoredf[2, ] <- c(mean(pids$PA.hard[pids$exp == 0]), sd(pids$PA.hard[pids$exp == 0]))
bp <- barplot(scoredf$mean, main = "Hard PA score by condition", 
        names.arg = c("Experimental", "Control"), col = 4:2, ylim = c(0, 1))
arrows(x0 = bp , y0 = scoredf$mean + scoredf$sd, y1 = scoredf$mean - scoredf$sd, 
       angle = 90, code = 3)

t.test(pids$PA.easy[pids$exp == 1], pids$PA.easy[pids$exp == 0])
scoredf[1, ] <- c(mean(pids$PA.easy[pids$exp == 1]), sd(pids$PA.easy[pids$exp == 1]))
scoredf[2, ] <- c(mean(pids$PA.easy[pids$exp == 0]), sd(pids$PA.easy[pids$exp == 0]))
bp <- barplot(scoredf$mean, main = "Easy PA score by condition", 
        names.arg = c("Experimental", "Control"), col = 4:2, ylim = c(0, 1))
arrows(x0 = bp , y0 = scoredf$mean + scoredf$sd, y1 = scoredf$mean - scoredf$sd, 
       angle = 90, code = 3)

# hard pa tasks: exp vs. control
t.test(pids$PA.hard[pids$exp == 1], pids$PA.hard[pids$exp == 0])
summary(aov(PA.hard ~ exp, data = pids))
summary(aov(PA.hard ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = pids))
# easy pa tasks: exp vs. control
t.test(pids$PA.easy[pids$exp == 1], pids$PA.easy[pids$exp == 0])
summary(aov(PA.easy ~ exp, data = pids))
summary(aov(PA.easy ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = pids))

summary(aov(I((PA.easy + PA.hard)/2) ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = pids))

getMeanSD(pids$PA.etime)
summary(aov(PA.etime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = pids))
getMeanSD(pids$PA.htime)
summary(aov(PA.htime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = pids))
```

WA analysis:
```{r}
for (i in 1:nrow(pids)){
  pid <- pids$PID[i]
  wafile <- filenames[grep(paste0("^", pid, "_wa"), filenames)]
  wafile <- read.csv(wafile, as.is = TRUE)
  wafile <- wafile[wafile$valid == 1, ] # only take valid words
  pids$WA.hard[i] <- sum(wafile$stimulus %in% c("kite", "scissors", "projector"))
  pids$WA.easy[i] <- sum(wafile$stimulus %in% c("rope", "ball", "wheel"))
  pids$WA.htime[i] <- mean(wafile$time[wafile$stimulus %in% 
                               c("kite", "scissors", "projector")])
  pids$WA.etime[i] <- mean(wafile$time[wafile$stimulus %in% 
                               c("rope", "ball", "wheel")])
}

t.test(pids$WA.easy, pids$WA.hard, paired = TRUE) 
t.test(pids$WA.etime, pids$WA.htime, paired = TRUE) 

cor.test(pids$Social.Jibo, pids$WA.hard)
summary(lm(formula = WA.hard ~ Social.Jibo, data = pids))
cor.test(pids$Social.Jibo, pids$WA.easy)
summary(lm(formula = WA.easy ~ Social.Jibo, data = pids))

plot(pids$Social.Jibo, pids$WA.easy, main = "easy WA score by Jibo Social rating", 
     xlab = "Jibo Social rating", ylab = "easy WA score")
abline(a = 29.475, b = -0.941, col = "red")
text("y =  29.475 - 0.941x", x = 3.5, y = 28, col = "red")

summary(lm(formula = WA.easy + WA.hard ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, pids$WA.easy + pids$WA.hard, main = "total WA score by Jibo Social rating", xlab = "Jibo Social rating", ylab = "total WA score")
abline(a = 51.635, b = -0.869, col = "red")
text("y =  51.635 - 0.869x", x = 3.5, y = 52, col = "red")

summary(lm(formula = WA.etime ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, pids$WA.etime, main = "easy WA time by Jibo Social rating", xlab = "Jibo Social rating", ylab = "easy WA time")
abline(a = 2.70, b = 0.113, col = "red")
text("y =  2.70 - 0.113x", x = 3.5, y = 2.5, col = "red")

summary(lm(formula = WA.htime ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, pids$WA.htime, main = "hard WA time by Jibo Social rating", xlab = "Jibo Social rating", ylab = "hard WA time")
abline(a = 3.280, b = 0.062, col = "red")
text("y =  3.280 + 0.062x", x = 3.5, y = 4, col = "red")

summary(lm(formula = WA.htime + WA.etime ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, pids$WA.htime + pids$WA.etime, main = "total WA time by Jibo Social rating", xlab = "Jibo Social rating", ylab = "total WA time")
abline(a = 5.979, b = 0.175, col = "red")
text("y =  5.979 + 0.175x", x = 7, y = 8, col = "red")

# time
t.test(pids$WA.htime[pids$exp == 1], pids$WA.htime[pids$exp == 0])# 3.57, 3.66
summary(aov(WA.htime ~  exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))
t.test(pids$WA.etime[pids$exp == 1], pids$WA.etime[pids$exp == 0]) # 3.36, 3.23
summary(aov(WA.etime ~  exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))

# hard wa tasks: exp vs. control
t.test(pids$WA.hard[pids$exp == 1], pids$WA.hard[pids$exp == 0])
summary(aov(WA.hard ~ exp, data = pids)) #means = 23.00, 22.13
summary(aov(WA.hard ~  exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))
# easy wa tasks: exp vs. control
t.test(pids$WA.easy[pids$exp == 1], pids$WA.easy[pids$exp == 0])
summary(aov(WA.easy ~ exp, data = pids)) #means = 23.88, 25.06
summary(aov(WA.easy ~  exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))

summary(aov(WA.easy + WA.hard ~  exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))
```

RC analysis: 
```{r}
questions = rep(0, 8)
pids$RC.hread = rep(NA, nrow(pids))
pids$RC.eread = rep(NA, nrow(pids))
pids$RC.dif = rep(NA, nrow(pids))
pids$RC.easy = rep(NA, nrow(pids))
for (i in 1:nrow(pids)){
  pid <- pids$PID[i]
  rcfile <- filenames[grep(paste0("^", pid, "_rc2"), filenames)]
  rcfile <- read.csv(rcfile)
  readfile <- filenames[grep(paste0("^", pid, "_rc1"), filenames)]
  readfile <- read.csv(readfile)
  colnames(rcfile) <- c("correct", "time")
  rcfile$correct <- as.logical(rcfile$correct)
  pids$RC.hard[i] <- mean(rcfile$correct[1:4])
  pids$RC.htime[i] <- sum(rcfile$time[1:4])
  pids$RC.easy[i] <- mean(rcfile$correct[5:8])
  pids$RC.etime[i] <- sum(rcfile$time[5:8])
  pids$RC.dif [i] <- mean(rcfile$correct[c(5, 7)])
  pids$RC.easy[i] <- mean(rcfile$correct[2:4])
  questions = questions + rcfile$correct[1:8]
  pids$RC.hread[i] <- sum(readfile[readfile$article == "hard",]$time)
  pids$RC.eread[i] <- sum(readfile[readfile$article == "easy",]$time)
}

questions # for 2 of the easy questions, almost nobody got it wrong

cor(pids$Social.Jibo, pids$RC.hard)
summary(lm(formula = RC.hard ~ Social.Jibo, data = pids))
cor(pids$Social.Jibo, pids$RC.easy)
summary(lm(formula = RC.easy ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, pids$RC.easy, main = "easy RC score by Jibo Social rating", 
     xlab = "Jibo Social rating", ylab = "easy RC score")
abline(a = 0.517, b = 0.028, col = "red")
text("y = 0.517 + 0.028x", x = 7, y = 0.6, col = "red")

summary(lm(formula = RC.easy + RC.hard ~ Social.Jibo, data = pids))
plot(pids$Social.Jibo, pids$RC.easy + pids$RC.hard, main = "total RC score by Jibo Social rating", xlab = "Jibo Social rating", ylab = "total RC score")
abline(a = 0.771, b = 0.046, col = "red")
text("y = 0.771 + 0.046x", x = 7, y = 0.7, col = "red")

summary(lm(formula = RC.hread ~ Social.Jibo, data = pids))
summary(lm(formula = RC.eread ~ Social.Jibo, data = pids))
summary(lm(formula = RC.htime ~ Social.Jibo, data = pids))
summary(lm(formula = RC.etime ~ Social.Jibo, data = pids))


# hard rc tasks: exp vs. control
t.test(pids$RC.hard[pids$exp == 1], pids$RC.hard[pids$exp == 0])
summary(aov(RC.hard ~ exp, data = pids))
summary(aov(RC.hard ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))
# easy rc tasks: exp vs. control
t.test(pids$RC.easy[pids$exp == 1], pids$RC.easy[pids$exp == 0])
summary(aov(RC.easy ~ exp, data = pids))
summary(aov(RC.easy ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))

# time spent:
# hard pa tasks: exp vs. control
t.test(pids$RC.htime[pids$exp == 1], pids$RC.htime[pids$exp == 0])
summary(aov(RC.htime ~ exp, data = pids))
summary(aov(RC.htime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))

# easy pa tasks: exp vs. control
t.test(pids$RC.etime[pids$exp == 1], pids$RC.etime[pids$exp == 0])
summary(aov(RC.etime ~ exp, data = pids))
summary(aov(RC.etime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))

# reading time
t.test(pids$RC.eread[pids$exp == 1], pids$RC.eread[pids$exp == 0])
summary(aov(RC.eread ~ exp, data = pids))
summary(aov(RC.eread ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))

t.test(pids$RC.hread[pids$exp == 1], pids$RC.hread[pids$exp == 0])
summary(aov(RC.hread ~ exp, data = pids))
summary(aov(RC.hread ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = pids))
```

Redoing all of the tests with "valid" (Jibo didn't turn off) PIDS
```{r}
invalidpids = c(778, 957, 440, 963, 804, 381, 764, 97, 21, 228)

remPIDS = function(remlist){
  return(pids[!(pids$PID %in% remlist), ])
}

validpids = remPIDS(invalidpids)
summary(lm(formula = PA.easy ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = validpids))
summary(lm(formula = PA.hard ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = validpids))
summary(lm(formula = PA.etime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = validpids))
summary(lm(formula = PA.htime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure + jpn, data = validpids))
summary(lm(formula = WA.easy ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = WA.hard ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = WA.etime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = WA.htime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = RC.easy ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = RC.hard ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = RC.etime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = RC.htime ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = RC.eread ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
summary(lm(formula = RC.hread ~ exp + age + male + BFI.extraversion + self.efficacy + empathy + cs1 + cs2 + cs3 + cs4 + rExposure, data = validpids))
```

